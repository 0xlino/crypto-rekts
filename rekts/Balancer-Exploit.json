{
    "id": 2358,
    "project_name": "Balancer",
    "title": "Balancer Exploit",
    "description": "<p>The transaction behind the attack:<br>https://etherscan.io/tx/0x013be97768b702fe8eccef1a40544d5ecb3c1961ad5f87fee4d16fdc08c78106<br><br>The attacker's address:<br>https://etherscan.io/address/0xbf675c80540111a310b06e1482f9127ef4e7469a<br><br>The attacker:<br>- borrowed a flash loan (104,331 WETH) from dYdX<br><br>- performed multiple <u>swapExactAmountIn</u>() calls within the same transaction to drain the STA balance in the attacked Balancer pool. <u>swapExactAmountIn</u>() sets the limit on the swap amount, i.e., <u>inRecord.balance</u> * <u>MAX_IN_RATIO</u>. The attacker calculated the limit and swapped the maximum allowed amount of WETH for STA via a flurry of operations. The result of performing the above swaps is to intentionally left 1e-18 in the Balancer pool<br><br>- by sending in 1e-18 STA into BPool via <u>swapExactAmountIn</u>(), the attacker swapped out 30,347 WETH in the first run. In internal records for book-keeping, <u>_records[STA]</u> is increased by <u>tokenAmountIn</u> (i.e., 1) before the BPool contract actually collects the corresponding STA tokens from the <u>msg.sender</u><br><br>- the <u>_pullUnderlying</u>() function collected the STA tokens. Note: STA is a deflationary token that charges shown 1% on every token transfer. Because of the transfer fee cut, the Balancer pool actually got zero STA tokens. Therefore, there\u2019s a mismatch between the actual STA balance of BPool and its internal records (i.e., <u>_records[STA]</u>)<br><br>- The <u>gulp</u>() is exploited to reset the <u>_records[STA]</u>, which helps the attacker to maintain the state that BPool has only 1e-18 STA<br><br>- repaid the flash loan back to dYdX.</p>",
    "name_categories": "Exchange (DEX)",
    "token_name": "BAL",
    "proof_archive_link": null,
    "technical_issue": null,
    "token_address": "0xba100000625a3754423978a60c9317c58a424e3d",
    "token_addresses": [],
    "logo_link": "safe/files/scamDatabase/logo/64ee19fcf0acf.png",
    "date": "2020-6-28",
    "scam_updates": [],
    "proof_link": "https://peckshield.medium.com/balancer-hacks-root-cause-and-loss-analysis-4916f7f0fff5, https://www.theblockcrypto.com/linked/69785/balancer-pools-drained-of-more-than-450000-due-to-an-exploit-connected-to-deflationary-tokens, https://cointelegraph.com/news/defi-protocol-balancer-hacked-through-exploit-it-seemingly-knew-about",
    "website_link": "https://balancer.fi/",
    "webarchive_link": null,
    "twitter_link": "https://twitter.com/BalancerLabs",
    "telegram_link": null,
    "our_post_link": null,
    "funds_lost": 523613,
    "funds_returned": 0,
    "funds_by_chains": [],
    "funds_recovered": null,
    "active": 1,
    "git_hub": null,
    "git_hub_contract_link": null,
    "discord": null,
    "bug_bounty_program_link": null,
    "bug_bounty_program_company": null,
    "audit_code_conf": 0,
    "is_verified_source_code": 0,
    "is_public_team": 0,
    "scam_type": {
        "id": 15,
        "type": "Flash Loan Attack"
    },
    "network": {},
    "scamNetworks": [
        {
            "networks_id": 1,
            "scam_database_id": 2358,
            "networks": {
                "id": 1,
                "name": "Ethereum",
                "icon_link": "safe/files/network/ethereum.png"
            }
        }
    ],
    "auditedBy": [
        {
            "audit_link": "safe/files/audit/pdf/Balancer_Finance_ConsenSys_Diligence1.pdf",
            "date": "2020-05-15T00:00:00.000Z",
            "partner": {
                "id": 14,
                "name": "ConsenSys Diligence",
                "logo_link": "safe/files/partner/logo/609524af19cf1.jpeg"
            }
        },
        {
            "audit_link": "safe/files/audit/pdf/BalancerCore.pdf",
            "date": "2020-03-05T00:00:00.000Z",
            "partner": {
                "id": 18,
                "name": "Trail of Bits",
                "logo_link": "safe/files/partner/logo/60a7a1cccf039.jpeg"
            }
        },
        {
            "audit_link": "safe/files/audit/pdf/Balancer_Contracts_Audit_OpenZeppelin_blog.pdf",
            "date": "2020-08-09T00:00:00.000Z",
            "partner": {
                "id": 20,
                "name": "OpenZeppelin",
                "logo_link": "safe/files/partner/logo/60adfe82d2af6.jpeg"
            }
        },
        {
            "audit_link": "safe/files/audit/pdf/Balancer_Finance_Process_Quality_Review_PQ_Reviews.pdf",
            "date": "2020-07-31T00:00:00.000Z",
            "partner": {
                "id": 23,
                "name": "DeFi Safety",
                "logo_link": "safe/files/partner/logo/6154df0c5cbef.png"
            }
        }
    ]
}