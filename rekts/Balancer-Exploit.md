# Balancer
![Balancer](/rektimages/Balancer-Exploit.png)
- Amount Lost: $523,613.00
- Funds Returned: $0.00
- Category: Exchange (DEX)
- Date: 2020-6-28

The transaction behind the attack:  
https://etherscan.io/tx/0x013be97768b702fe8eccef1a40544d5ecb3c1961ad5f87fee4d16fdc08c78106  
  
The attacker's address:  
https://etherscan.io/address/0xbf675c80540111a310b06e1482f9127ef4e7469a  
  
The attacker:  
\- borrowed a flash loan (104,331 WETH) from dYdX  
  
\- performed multiple _swapExactAmountIn_ () calls within the same transaction to drain the STA balance in the attacked Balancer pool. _swapExactAmountIn_ () sets the limit on the swap amount, i.e., _inRecord.balance_ * _MAX_IN_RATIO_. The attacker calculated the limit and swapped the maximum allowed amount of WETH for STA via a flurry of operations. The result of performing the above swaps is to intentionally left 1e-18 in the Balancer pool  
  
\- by sending in 1e-18 STA into BPool via _swapExactAmountIn_ (), the attacker swapped out 30,347 WETH in the first run. In internal records for book-keeping, __records[STA]_ is increased by _tokenAmountIn_ (i.e., 1) before the BPool contract actually collects the corresponding STA tokens from the _msg.sender_  
  
\- the __pullUnderlying_ () function collected the STA tokens. Note: STA is a deflationary token that charges shown 1% on every token transfer. Because of the transfer fee cut, the Balancer pool actually got zero STA tokens. Therefore, thereâ€™s a mismatch between the actual STA balance of BPool and its internal records (i.e., __records[STA]_ )  
  
\- The _gulp_ () is exploited to reset the __records[STA]_ , which helps the attacker to maintain the state that BPool has only 1e-18 STA  
  
\- repaid the flash loan back to dYdX.


Proof Links:
- [https://peckshield.medium.com/balancer-hacks-root-cause-and-loss-analysis-4916f7f0fff5](https://peckshield.medium.com/balancer-hacks-root-cause-and-loss-analysis-4916f7f0fff5)
- [ https://www.theblockcrypto.com/linked/69785/balancer-pools-drained-of-more-than-450000-due-to-an-exploit-connected-to-deflationary-tokens]( https://www.theblockcrypto.com/linked/69785/balancer-pools-drained-of-more-than-450000-due-to-an-exploit-connected-to-deflationary-tokens)
- [ https://cointelegraph.com/news/defi-protocol-balancer-hacked-through-exploit-it-seemingly-knew-about]( https://cointelegraph.com/news/defi-protocol-balancer-hacked-through-exploit-it-seemingly-knew-about)


